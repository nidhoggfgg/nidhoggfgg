(function(){'use strict';function e(t,n){if(e.instance_)return e.instance_;e.instance_=this,this.outerContainerEl=document.querySelector(t),this.containerEl=null,this.snackbarEl=null,this.detailsButton=this.outerContainerEl.querySelector("#details-button"),this.config=n||e.config,this.dimensions=e.defaultDimensions,this.canvas=null,this.canvasCtx=null,this.tRex=null,this.distanceMeter=null,this.distanceRan=0,this.highestScore=0,this.time=0,this.runningTime=0,this.msPerFrame=1e3/h,this.currentSpeed=this.config.SPEED,this.obstacles=[],this.activated=!1,this.playing=!1,this.crashed=!1,this.paused=!1,this.inverted=!1,this.invertTimer=0,this.resizeTimerId_=null,this.playCount=0,this.audioBuffer=null,this.soundFx={},this.audioContext=null,this.images={},this.imagesLoaded=0,this.isDisabled()?this.setupDisabledRunner():this.loadImages()}window.Runner=e;var p=600,h=60,f=/iPad|iPhone|iPod/.test(window.navigator.platform),d=/Android/.test(window.navigator.userAgent)||f,O="ontouchstart"in window;e.config={ACCELERATION:.001,BG_CLOUD_SPEED:.2,BOTTOM_PAD:10,CLEAR_TIME:3e3,CLOUD_FREQUENCY:.5,GAMEOVER_CLEAR_TIME:750,GAP_COEFFICIENT:.6,GRAVITY:.6,INITIAL_JUMP_VELOCITY:12,INVERT_FADE_DURATION:12e3,INVERT_DISTANCE:700,MAX_BLINK_COUNT:3,MAX_CLOUDS:6,MAX_OBSTACLE_LENGTH:3,MAX_OBSTACLE_DUPLICATION:2,MAX_SPEED:13,MIN_JUMP_HEIGHT:35,MOBILE_SPEED_COEFFICIENT:1.2,RESOURCE_TEMPLATE_ID:"audio-resources",SPEED:6,SPEED_DROP_COEFFICIENT:3},e.defaultDimensions={WIDTH:p,HEIGHT:150},e.classes={CANVAS:"runner-canvas",CONTAINER:"runner-container",CRASHED:"crashed",ICON:"icon-offline",INVERTED:"inverted",SNACKBAR:"snackbar",SNACKBAR_SHOW:"snackbar-show",TOUCH_CONTROLLER:"controller"},e.spriteDefinition={LDPI:{CACTUS_LARGE:{x:332,y:2},CACTUS_SMALL:{x:228,y:2},CLOUD:{x:86,y:2},HORIZON:{x:2,y:54},MOON:{x:484,y:2},PTERODACTYL:{x:134,y:2},RESTART:{x:2,y:2},TEXT_SPRITE:{x:655,y:2},TREX:{x:848,y:2},STAR:{x:645,y:2}},HDPI:{CACTUS_LARGE:{x:652,y:2},CACTUS_SMALL:{x:446,y:2},CLOUD:{x:166,y:2},HORIZON:{x:2,y:104},MOON:{x:954,y:2},PTERODACTYL:{x:260,y:2},RESTART:{x:2,y:2},TEXT_SPRITE:{x:1294,y:2},TREX:{x:1678,y:2},STAR:{x:1276,y:2}}},e.sounds={BUTTON_PRESS:"offline-sound-press",HIT:"offline-sound-hit",SCORE:"offline-sound-reached"},e.keycodes={JUMP:{38:1,32:1},DUCK:{40:1},RESTART:{13:1}},e.events={ANIM_END:"webkitAnimationEnd",CLICK:"click",KEYDOWN:"keydown",KEYUP:"keyup",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",RESIZE:"resize",TOUCHEND:"touchend",TOUCHSTART:"touchstart",VISIBILITY:"visibilitychange",BLUR:"blur",FOCUS:"focus",LOAD:"load"},e.prototype={isDisabled:function(){return!1},setupDisabledRunner:function(){this.containerEl=document.createElement("div"),this.containerEl.className=e.classes.SNACKBAR,this.containerEl.textContent=loadTimeData.getValue("disabledEasterEgg"),this.outerContainerEl.appendChild(this.containerEl),document.addEventListener(e.events.KEYDOWN,function(t){e.keycodes.JUMP[t.keyCode]&&(this.containerEl.classList.add(e.classes.SNACKBAR_SHOW),document.querySelector(".icon").classList.add("icon-disabled"))}.bind(this))},updateConfigSetting:function(t,e){if(t in this.config&&e!=void 0)switch(this.config[t]=e,t){case"GRAVITY":case"MIN_JUMP_HEIGHT":case"SPEED_DROP_COEFFICIENT":this.tRex.config[t]=e;break;case"INITIAL_JUMP_VELOCITY":this.tRex.setJumpVelocity(e);break;case"SPEED":this.setSpeed(e);break}},loadImages:function(){e.imageSprite=document.getElementById("offline-resources-1x"),this.spriteDef=e.spriteDefinition.LDPI,e.imageSprite.complete?this.init():e.imageSprite.addEventListener(e.events.LOAD,this.init.bind(this))},loadSounds:function(){if(!f){this.audioContext=new AudioContext;var t,n,s,o=document.getElementById(this.config.RESOURCE_TEMPLATE_ID).content;for(n in e.sounds)t=o.getElementById(e.sounds[n]).src,t=t.substr(t.indexOf(",")+1),s=j(t),this.audioContext.decodeAudioData(s,function(e,t){this.soundFx[e]=t}.bind(this,n))}},setSpeed:function(e){var n,t=e||this.currentSpeed;this.dimensions.WIDTH<p?(n=t*this.dimensions.WIDTH/p*this.config.MOBILE_SPEED_COEFFICIENT,this.currentSpeed=n>t?t:n):e&&(this.currentSpeed=e)},init:function(){document.querySelector("."+e.classes.ICON).style.visibility="hidden",this.adjustDimensions(),this.setSpeed(),this.containerEl=document.createElement("div"),this.containerEl.className=e.classes.CONTAINER,this.canvas=y(this.containerEl,this.dimensions.WIDTH,this.dimensions.HEIGHT,e.classes.PLAYER),this.canvasCtx=this.canvas.getContext("2d"),this.canvasCtx.fillStyle="#f7f7f7",this.canvasCtx.fill(),e.updateCanvasScaling(this.canvas),this.horizon=new m(this.canvas,this.spriteDef,this.dimensions,this.config.GAP_COEFFICIENT),this.distanceMeter=new o(this.canvas,this.spriteDef.TEXT_SPRITE,this.dimensions.WIDTH),this.tRex=new t(this.canvas,this.spriteDef.TREX),this.outerContainerEl.appendChild(this.containerEl),d&&this.createTouchController(),this.startListening(),this.update(),window.addEventListener(e.events.RESIZE,this.debounceResize.bind(this))},createTouchController:function(){this.touchController=document.createElement("div"),this.touchController.className=e.classes.TOUCH_CONTROLLER,this.outerContainerEl.appendChild(this.touchController)},debounceResize:function(){this.resizeTimerId_||(this.resizeTimerId_=setInterval(this.adjustDimensions.bind(this),250))},adjustDimensions:function(){clearInterval(this.resizeTimerId_),this.resizeTimerId_=null;var t=window.getComputedStyle(this.outerContainerEl),n=Number(t.paddingLeft.substr(0,t.paddingLeft.length-2));this.dimensions.WIDTH=this.outerContainerEl.offsetWidth-n*2,this.canvas&&(this.canvas.width=this.dimensions.WIDTH,this.canvas.height=this.dimensions.HEIGHT,e.updateCanvasScaling(this.canvas),this.distanceMeter.calcXPos(this.dimensions.WIDTH),this.clearCanvas(),this.horizon.update(0,0,!0),this.tRex.update(0),this.playing||this.crashed||this.paused?(this.containerEl.style.width=this.dimensions.WIDTH+"px",this.containerEl.style.height=this.dimensions.HEIGHT+"px",this.distanceMeter.update(0,Math.ceil(this.distanceRan)),this.stop()):this.tRex.draw(0,0),this.crashed&&this.gameOverPanel&&(this.gameOverPanel.updateDimensions(this.dimensions.WIDTH),this.gameOverPanel.draw()))},playIntro:function(){if(!this.activated&&!this.crashed){this.playingIntro=!0,this.tRex.playingIntro=!0;var s="@-webkit-keyframes intro { from { width:"+t.config.WIDTH+"px }"+"to { width: "+this.dimensions.WIDTH+"px }"+"}",n=document.createElement("style");n.innerHTML=s,document.head.appendChild(n),this.containerEl.addEventListener(e.events.ANIM_END,this.startGame.bind(this)),this.containerEl.style.webkitAnimation="intro .4s ease-out 1 both",this.containerEl.style.width=this.dimensions.WIDTH+"px",this.playing=!0,this.activated=!0}else this.crashed&&this.restart()},startGame:function(){this.runningTime=0,this.playingIntro=!1,this.tRex.playingIntro=!1,this.containerEl.style.webkitAnimation='',this.playCount++,document.addEventListener(e.events.VISIBILITY,this.onVisibilityChange.bind(this)),window.addEventListener(e.events.BLUR,this.onVisibilityChange.bind(this)),window.addEventListener(e.events.FOCUS,this.onVisibilityChange.bind(this))},clearCanvas:function(){this.canvasCtx.clearRect(0,0,this.dimensions.WIDTH,this.dimensions.HEIGHT)},update:function(){this.updatePending=!1;var n,o,i,a,s=l(),t=s-(this.time||s);this.time=s,this.playing&&(this.clearCanvas(),this.tRex.jumping&&this.tRex.updateJump(t),this.runningTime+=t,n=this.runningTime>this.config.CLEAR_TIME,this.tRex.jumpCount==1&&!this.playingIntro&&this.playIntro(),this.playingIntro?this.horizon.update(0,this.currentSpeed,n):(t=this.activated?t:0,this.horizon.update(t,this.currentSpeed,n,this.inverted)),i=n&&w(this.horizon.obstacles[0],this.tRex),i?this.gameOver():(this.distanceRan+=this.currentSpeed*t/this.msPerFrame,this.currentSpeed<this.config.MAX_SPEED&&(this.currentSpeed+=this.config.ACCELERATION)),a=this.distanceMeter.update(t,Math.ceil(this.distanceRan)),a&&this.playSound(this.soundFx.SCORE),this.invertTimer>this.config.INVERT_FADE_DURATION?(this.invertTimer=0,this.invertTrigger=!1,this.invert()):this.invertTimer?this.invertTimer+=t:(o=this.distanceMeter.getActualDistance(Math.ceil(this.distanceRan)),o>0&&(this.invertTrigger=!(o%this.config.INVERT_DISTANCE),this.invertTrigger&&this.invertTimer===0&&(this.invertTimer+=t,this.invert())))),(this.playing||!this.activated&&this.tRex.blinkCount<e.config.MAX_BLINK_COUNT)&&(this.tRex.update(t),this.scheduleNextUpdate())},handleEvent:function(t){return function(n,e){switch(n){case e.KEYDOWN:case e.TOUCHSTART:case e.MOUSEDOWN:this.onKeyDown(t);break;case e.KEYUP:case e.TOUCHEND:case e.MOUSEUP:this.onKeyUp(t);break}}.bind(this)(t.type,e.events)},startListening:function(){document.addEventListener(e.events.KEYDOWN,this),document.addEventListener(e.events.KEYUP,this),d?(document.addEventListener(e.events.TOUCHSTART,this),document.addEventListener(e.events.TOUCHEND,this)):(document.addEventListener(e.events.MOUSEDOWN,this),document.addEventListener(e.events.MOUSEUP,this))},stopListening:function(){document.removeEventListener(e.events.KEYDOWN,this),document.removeEventListener(e.events.KEYUP,this),d?(document.removeEventListener(e.events.TOUCHSTART,this),document.removeEventListener(e.events.TOUCHEND,this)):(document.removeEventListener(e.events.MOUSEDOWN,this),document.removeEventListener(e.events.MOUSEUP,this))},onKeyDown:function(t){d&&this.playing&&t.preventDefault(),t.target!=this.detailsButton&&(!this.crashed&&(e.keycodes.JUMP[t.keyCode]||t.type==e.events.TOUCHSTART)&&(this.playing||(this.loadSounds(),this.playing=!0,this.update(),window.errorPageController&&errorPageController.trackEasterEgg()),!this.tRex.jumping&&!this.tRex.ducking&&(this.playSound(this.soundFx.BUTTON_PRESS),this.tRex.startJump(this.currentSpeed))),this.crashed&&t.type==e.events.TOUCHSTART&&this.restart()),this.playing&&!this.crashed&&e.keycodes.DUCK[t.keyCode]&&(t.preventDefault(),this.tRex.jumping?this.tRex.setSpeedDrop():!this.tRex.jumping&&!this.tRex.ducking&&this.tRex.setDuck(!0))},onKeyUp:function(t){var o,n=String(t.keyCode),s=e.keycodes.JUMP[n]||t.type==e.events.TOUCHEND||t.type==e.events.MOUSEDOWN;this.isRunning()&&s?this.tRex.endJump():e.keycodes.DUCK[n]?(this.tRex.speedDrop=!1,this.tRex.setDuck(!1)):this.crashed?(o=l()-this.time,(e.keycodes.RESTART[n]||this.isLeftClickOnCanvas(t)||o>=this.config.GAMEOVER_CLEAR_TIME&&e.keycodes.JUMP[n])&&this.restart()):this.paused&&s&&(this.tRex.reset(),this.play())},isLeftClickOnCanvas:function(t){return t.button!=null&&t.button<2&&t.type==e.events.MOUSEUP&&t.target==this.canvas},scheduleNextUpdate:function(){this.updatePending||(this.updatePending=!0,this.raqId=requestAnimationFrame(this.update.bind(this)))},isRunning:function(){return!!this.raqId},gameOver:function(){this.playSound(this.soundFx.HIT),_(200),this.stop(),this.crashed=!0,this.distanceMeter.acheivement=!1,this.tRex.update(100,t.status.CRASHED),this.gameOverPanel?this.gameOverPanel.draw():this.gameOverPanel=new u(this.canvas,this.spriteDef.TEXT_SPRITE,this.spriteDef.RESTART,this.dimensions),this.distanceRan>this.highestScore&&(this.highestScore=Math.ceil(this.distanceRan),this.distanceMeter.setHighScore(this.highestScore)),this.time=l()},stop:function(){this.playing=!1,this.paused=!0,cancelAnimationFrame(this.raqId),this.raqId=0},play:function(){this.crashed||(this.playing=!0,this.paused=!1,this.tRex.update(0,t.status.RUNNING),this.time=l(),this.update())},restart:function(){this.raqId||(this.playCount++,this.runningTime=0,this.playing=!0,this.crashed=!1,this.distanceRan=0,this.setSpeed(this.config.SPEED),this.time=l(),this.containerEl.classList.remove(e.classes.CRASHED),this.clearCanvas(),this.distanceMeter.reset(this.highestScore),this.horizon.reset(),this.tRex.reset(),this.playSound(this.soundFx.BUTTON_PRESS),this.invert(!0),this.update())},onVisibilityChange:function(e){document.hidden||document.webkitHidden||e.type=="blur"||document.visibilityState!="visible"?this.stop():this.crashed||(this.tRex.reset(),this.play())},playSound:function(t){if(t){var e=this.audioContext.createBufferSource();e.buffer=t,e.connect(this.audioContext.destination),e.start(0)}},invert:function(t){t?(document.body.classList.toggle(e.classes.INVERTED,!1),this.invertTimer=0,this.inverted=!1):this.inverted=document.body.classList.toggle(e.classes.INVERTED,this.invertTrigger)}},e.updateCanvasScaling=function(e,r,c){var n,s,i=e.getContext("2d"),o=Math.floor(window.devicePixelRatio)||1,a=Math.floor(i.webkitBackingStorePixelRatio)||1,t=o/a;return o!==a?(n=r||e.width,s=c||e.height,e.width=n*t,e.height=s*t,e.style.width=n+"px",e.style.height=s+"px",i.scale(t,t),!0):(o==1&&(e.style.width=e.width+"px",e.style.height=e.height+"px"),!1)};function c(e,t){return Math.floor(Math.random()*(t-e+1))+e}function _(e){d&&window.navigator.vibrate&&window.navigator.vibrate(e)}function y(s,o,i,n){var t=document.createElement("canvas");return t.className=n?e.classes.CANVAS+" "+n:e.classes.CANVAS,t.width=o,t.height=i,s.appendChild(t),t}function j(t){for(var n=t.length/4*3,o=atob(t),i=new ArrayBuffer(n),s=new Uint8Array(i),e=0;e<n;e++)s[e]=o.charCodeAt(e);return s.buffer}function l(){return f?(new Date).getTime():performance.now()}function u(e,t,n,s){this.canvas=e,this.canvasCtx=e.getContext("2d"),this.canvasDimensions=s,this.textImgPos=t,this.restartImgPos=n,this.draw()}u.dimensions={TEXT_X:0,TEXT_Y:13,TEXT_WIDTH:191,TEXT_HEIGHT:11,RESTART_WIDTH:36,RESTART_HEIGHT:32},u.prototype={updateDimensions:function(t,e){this.canvasDimensions.WIDTH=t,e&&(this.canvasDimensions.HEIGHT=e)},draw:function(){var t=u.dimensions,n=this.canvasDimensions.WIDTH/2,s=t.TEXT_X,o=t.TEXT_Y,c=t.TEXT_WIDTH,a=t.TEXT_HEIGHT,r=Math.round(n-t.TEXT_WIDTH/2),i=Math.round((this.canvasDimensions.HEIGHT-25)/3),l=t.TEXT_WIDTH,d=t.TEXT_HEIGHT,h=t.RESTART_WIDTH,m=t.RESTART_HEIGHT,f=n-t.RESTART_WIDTH/2,p=this.canvasDimensions.HEIGHT/2;s+=this.textImgPos.x,o+=this.textImgPos.y,this.canvasCtx.drawImage(e.imageSprite,s,o,c,a,r,i,l,d),this.canvasCtx.drawImage(e.imageSprite,this.restartImgPos.x,this.restartImgPos.y,h,m,f,p,t.RESTART_WIDTH,t.RESTART_HEIGHT)}};function w(n,o,i){var a,r,c,l,d,u,f,p=e.defaultDimensions.WIDTH+n.xPos,m=new s(o.xPos+1,o.yPos+1,o.config.WIDTH-2,o.config.HEIGHT-2),h=new s(n.xPos+1,n.yPos+1,n.typeConfig.width*n.size-2,n.typeConfig.height-2);if(i&&g(i,m,h),v(m,h)){d=n.collisionBoxes,u=o.ducking?t.collisionBoxes.DUCKING:t.collisionBoxes.RUNNING;for(l=0;l<u.length;l++)for(c=0;c<d.length;c++)if(r=b(u[l],m),a=b(d[c],h),f=v(r,a),i&&g(i,r,a),f)return[r,a]}return!1}function b(e,t){return new s(e.x+t.x,e.y+t.y,e.width,e.height)}function g(e,t,n){e.save(),e.strokeStyle="#f00",e.strokeRect(t.x,t.y,t.width,t.height),e.strokeStyle="#0f0",e.strokeRect(n.x,n.y,n.width,n.height),e.restore()}function v(e,t){var n=!1,o=e.x,i=e.y,s=t.x,a=t.y;return e.x<s+t.width&&e.x+e.width>s&&e.y<t.y+t.height&&e.height+e.y>t.y&&(n=!0),n}function s(e,t,n,s){this.x=e,this.y=t,this.width=n,this.height=s}function r(t,n,s,e,o,i,a){this.canvasCtx=t,this.spritePos=s,this.typeConfig=n,this.gapCoefficient=o,this.size=c(1,r.MAX_OBSTACLE_LENGTH),this.dimensions=e,this.remove=!1,this.xPos=e.WIDTH+(a||0),this.yPos=0,this.width=0,this.collisionBoxes=[],this.gap=0,this.speedOffset=0,this.currentFrame=0,this.timer=0,this.init(i)}r.MAX_GAP_COEFFICIENT=1.5,r.MAX_OBSTACLE_LENGTH=3,r.prototype={init:function(e){if(this.cloneCollisionBoxes(),this.size>1&&this.typeConfig.multipleSpeed>e&&(this.size=1),this.width=this.typeConfig.width*this.size,Array.isArray(this.typeConfig.yPos)){var t=d?this.typeConfig.yPosMobile:this.typeConfig.yPos;this.yPos=t[c(0,t.length-1)]}else this.yPos=this.typeConfig.yPos;this.draw(),this.size>1&&(this.collisionBoxes[1].width=this.width-this.collisionBoxes[0].width-this.collisionBoxes[2].width,this.collisionBoxes[2].x=this.width-this.collisionBoxes[2].width),this.typeConfig.speedOffset&&(this.speedOffset=Math.random()>.5?this.typeConfig.speedOffset:-this.typeConfig.speedOffset),this.gap=this.getGap(this.gapCoefficient,e)},draw:function(){var t=this.typeConfig.width,s=this.typeConfig.height,n=t*this.size*(.5*(this.size-1))+this.spritePos.x;this.currentFrame>0&&(n+=t*this.currentFrame),this.canvasCtx.drawImage(e.imageSprite,n,this.spritePos.y,t*this.size,s,this.xPos,this.yPos,this.typeConfig.width*this.size,this.typeConfig.height)},update:function(e,t){this.remove||(this.typeConfig.speedOffset&&(t+=this.speedOffset),this.xPos-=Math.floor(t*h/1e3*e),this.typeConfig.numFrames&&(this.timer+=e,this.timer>=this.typeConfig.frameRate&&(this.currentFrame=this.currentFrame==this.typeConfig.numFrames-1?0:this.currentFrame+1,this.timer=0)),this.draw(),this.isVisible()||(this.remove=!0))},getGap:function(t,n){var e=Math.round(this.width*n+this.typeConfig.minGap*t),s=Math.round(e*r.MAX_GAP_COEFFICIENT);return c(e,s)},isVisible:function(){return this.xPos+this.width>0},cloneCollisionBoxes:function(){for(var t=this.typeConfig.collisionBoxes,e=t.length-1;e>=0;e--)this.collisionBoxes[e]=new s(t[e].x,t[e].y,t[e].width,t[e].height)}},r.types=[{type:"CACTUS_SMALL",width:17,height:35,yPos:105,multipleSpeed:4,minGap:120,minSpeed:0,collisionBoxes:[new s(0,7,5,27),new s(4,0,6,34),new s(10,4,7,14)]},{type:"CACTUS_LARGE",width:25,height:50,yPos:90,multipleSpeed:7,minGap:120,minSpeed:0,collisionBoxes:[new s(0,12,7,38),new s(8,0,7,49),new s(13,10,10,38)]},{type:"PTERODACTYL",width:46,height:40,yPos:[100,75,50],yPosMobile:[100,50],multipleSpeed:999,minSpeed:8.5,minGap:150,collisionBoxes:[new s(15,15,16,5),new s(18,21,24,6),new s(2,14,4,3),new s(6,10,4,7),new s(10,8,6,9)],numFrames:2,frameRate:1e3/6,speedOffset:.8}];function t(e,n){this.canvas=e,this.canvasCtx=e.getContext("2d"),this.spritePos=n,this.xPos=0,this.yPos=0,this.groundYPos=0,this.currentFrame=0,this.currentAnimFrames=[],this.blinkDelay=0,this.blinkCount=0,this.animStartTime=0,this.timer=0,this.msPerFrame=1e3/h,this.config=t.config,this.status=t.status.WAITING,this.jumping=!1,this.ducking=!1,this.jumpVelocity=0,this.reachedMinHeight=!1,this.speedDrop=!1,this.jumpCount=0,this.jumpspotX=0,this.init()}t.config={DROP_VELOCITY:-5,GRAVITY:.6,HEIGHT:47,HEIGHT_DUCK:25,INIITAL_JUMP_VELOCITY:-10,INTRO_DURATION:1500,MAX_JUMP_HEIGHT:30,MIN_JUMP_HEIGHT:30,SPEED_DROP_COEFFICIENT:3,SPRITE_WIDTH:262,START_X_POS:50,WIDTH:44,WIDTH_DUCK:59},t.collisionBoxes={DUCKING:[new s(1,18,55,25)],RUNNING:[new s(22,0,17,16),new s(1,18,30,9),new s(10,35,14,8),new s(1,24,29,5),new s(5,30,21,4),new s(9,34,15,4)]},t.status={CRASHED:"CRASHED",DUCKING:"DUCKING",JUMPING:"JUMPING",RUNNING:"RUNNING",WAITING:"WAITING"},t.BLINK_TIMING=7e3,t.animFrames={WAITING:{frames:[44,0],msPerFrame:1e3/3},RUNNING:{frames:[88,132],msPerFrame:1e3/12},CRASHED:{frames:[220],msPerFrame:1e3/60},JUMPING:{frames:[0],msPerFrame:1e3/60},DUCKING:{frames:[264,323],msPerFrame:1e3/8}},t.prototype={init:function(){this.groundYPos=e.defaultDimensions.HEIGHT-this.config.HEIGHT-e.config.BOTTOM_PAD,this.yPos=this.groundYPos,this.minJumpHeight=this.groundYPos-this.config.MIN_JUMP_HEIGHT,this.draw(0,0),this.update(0,t.status.WAITING)},setJumpVelocity:function(e){this.config.INIITAL_JUMP_VELOCITY=-e,this.config.DROP_VELOCITY=-e/2},update:function(n,e){this.timer+=n,e&&(this.status=e,this.currentFrame=0,this.msPerFrame=t.animFrames[e].msPerFrame,this.currentAnimFrames=t.animFrames[e].frames,e==t.status.WAITING&&(this.animStartTime=l(),this.setBlinkDelay())),this.playingIntro&&this.xPos<this.config.START_X_POS&&(this.xPos+=Math.round(this.config.START_X_POS/this.config.INTRO_DURATION*n)),this.status==t.status.WAITING?this.blink(l()):this.draw(this.currentAnimFrames[this.currentFrame],0),this.timer>=this.msPerFrame&&(this.currentFrame=this.currentFrame==this.currentAnimFrames.length-1?0:this.currentFrame+1,this.timer=0),this.speedDrop&&this.yPos==this.groundYPos&&(this.speedDrop=!1,this.setDuck(!0))},draw:function(a,r){var n=a,s=r,o=this.ducking&&this.status!=t.status.CRASHED?this.config.WIDTH_DUCK:this.config.WIDTH,i=this.config.HEIGHT;n+=this.spritePos.x,s+=this.spritePos.y,this.ducking&&this.status!=t.status.CRASHED?this.canvasCtx.drawImage(e.imageSprite,n,s,o,i,this.xPos,this.yPos,this.config.WIDTH_DUCK,this.config.HEIGHT):(this.ducking&&this.status==t.status.CRASHED&&this.xPos++,this.canvasCtx.drawImage(e.imageSprite,n,s,o,i,this.xPos,this.yPos,this.config.WIDTH,this.config.HEIGHT))},setBlinkDelay:function(){this.blinkDelay=Math.ceil(Math.random()*t.BLINK_TIMING)},blink:function(e){var t=e-this.animStartTime;t>=this.blinkDelay&&(this.draw(this.currentAnimFrames[this.currentFrame],0),this.currentFrame==1&&(this.setBlinkDelay(),this.animStartTime=e,this.blinkCount++))},startJump:function(e){this.jumping||(this.update(0,t.status.JUMPING),this.jumpVelocity=this.config.INIITAL_JUMP_VELOCITY-e/10,this.jumping=!0,this.reachedMinHeight=!1,this.speedDrop=!1)},endJump:function(){this.reachedMinHeight&&this.jumpVelocity<this.config.DROP_VELOCITY&&(this.jumpVelocity=this.config.DROP_VELOCITY)},updateJump:function(n){var s=t.animFrames[this.status].msPerFrame,e=n/s;this.speedDrop?this.yPos+=Math.round(this.jumpVelocity*this.config.SPEED_DROP_COEFFICIENT*e):this.yPos+=Math.round(this.jumpVelocity*e),this.jumpVelocity+=this.config.GRAVITY*e,(this.yPos<this.minJumpHeight||this.speedDrop)&&(this.reachedMinHeight=!0),(this.yPos<this.config.MAX_JUMP_HEIGHT||this.speedDrop)&&this.endJump(),this.yPos>this.groundYPos&&(this.reset(),this.jumpCount++),this.update(n)},setSpeedDrop:function(){this.speedDrop=!0,this.jumpVelocity=1},setDuck:function(e){e&&this.status!=t.status.DUCKING?(this.update(0,t.status.DUCKING),this.ducking=!0):this.status==t.status.DUCKING&&(this.update(0,t.status.RUNNING),this.ducking=!1)},reset:function(){this.yPos=this.groundYPos,this.jumpVelocity=0,this.jumping=!1,this.ducking=!1,this.update(0,t.status.RUNNING),this.midair=!1,this.speedDrop=!1,this.jumpCount=0}};function o(t,n,s){this.canvas=t,this.canvasCtx=t.getContext("2d"),this.image=e.imageSprite,this.spritePos=n,this.x=0,this.y=5,this.currentDistance=0,this.maxScore=0,this.highScore=0,this.container=null,this.digits=[],this.acheivement=!1,this.defaultString='',this.flashTimer=0,this.flashIterations=0,this.invertTrigger=!1,this.config=o.config,this.maxScoreUnits=this.config.MAX_DISTANCE_UNITS,this.init(s)}o.dimensions={WIDTH:10,HEIGHT:13,DEST_WIDTH:11},o.yPos=[0,13,27,40,53,67,80,93,107,120],o.config={MAX_DISTANCE_UNITS:5,ACHIEVEMENT_DISTANCE:100,COEFFICIENT:.025,FLASH_DURATION:1e3/4,FLASH_ITERATIONS:3},o.prototype={init:function(n){var e,t='';this.calcXPos(n),this.maxScore=this.maxScoreUnits;for(e=0;e<this.maxScoreUnits;e++)this.draw(e,0),this.defaultString+="0",t+="9";this.maxScore=parseInt(t)},calcXPos:function(e){this.x=e-o.dimensions.DEST_WIDTH*(this.maxScoreUnits+1)},draw:function(c,s,i){var n,a=o.dimensions.WIDTH,r=o.dimensions.HEIGHT,t=o.dimensions.WIDTH*s,e=0,l=c*o.dimensions.DEST_WIDTH,d=this.y,u=o.dimensions.WIDTH,h=o.dimensions.HEIGHT;t+=this.spritePos.x,e+=this.spritePos.y,this.canvasCtx.save(),i?(n=this.x-this.maxScoreUnits*2*o.dimensions.WIDTH,this.canvasCtx.translate(n,this.y)):this.canvasCtx.translate(this.x,this.y),this.canvasCtx.drawImage(this.image,t,e,a,r,l,d,u,h),this.canvasCtx.restore()},getActualDistance:function(e){return e?Math.round(e*this.config.COEFFICIENT):0},update:function(i,e){var t,o,n=!0,s=!1;if(this.acheivement?this.flashIterations<=this.config.FLASH_ITERATIONS?(this.flashTimer+=i,this.flashTimer<this.config.FLASH_DURATION?n=!1:this.flashTimer>this.config.FLASH_DURATION*2&&(this.flashTimer=0,this.flashIterations++)):(this.acheivement=!1,this.flashIterations=0,this.flashTimer=0):(e=this.getActualDistance(e),e>this.maxScore&&this.maxScoreUnits==this.config.MAX_DISTANCE_UNITS?(this.maxScoreUnits++,this.maxScore=parseInt(this.maxScore+"9")):this.distance=0,e>0?(e%this.config.ACHIEVEMENT_DISTANCE==0&&(this.acheivement=!0,this.flashTimer=0,s=!0),o=(this.defaultString+e).substr(-this.maxScoreUnits),this.digits=o.split('')):this.digits=this.defaultString.split('')),n)for(t=this.digits.length-1;t>=0;t--)this.draw(t,parseInt(this.digits[t]));return this.drawHighScore(),s},drawHighScore:function(){this.canvasCtx.save(),this.canvasCtx.globalAlpha=.8;for(var e=this.highScore.length-1;e>=0;e--)this.draw(e,parseInt(this.highScore[e],10),!0);this.canvasCtx.restore()},setHighScore:function(e){e=this.getActualDistance(e);var t=(this.defaultString+e).substr(-this.maxScoreUnits);this.highScore=["10","11",''].concat(t.split(''))},reset:function(){this.update(0),this.acheivement=!1}};function i(t,n,e){this.canvas=t,this.canvasCtx=this.canvas.getContext("2d"),this.spritePos=n,this.containerWidth=e,this.xPos=e,this.yPos=0,this.remove=!1,this.cloudGap=c(i.config.MIN_CLOUD_GAP,i.config.MAX_CLOUD_GAP),this.init()}i.config={HEIGHT:14,MAX_CLOUD_GAP:400,MAX_SKY_LEVEL:30,MIN_CLOUD_GAP:100,MIN_SKY_LEVEL:71,WIDTH:46},i.prototype={init:function(){this.yPos=c(i.config.MAX_SKY_LEVEL,i.config.MIN_SKY_LEVEL),this.draw()},draw:function(){this.canvasCtx.save();var t=i.config.WIDTH,n=i.config.HEIGHT;this.canvasCtx.drawImage(e.imageSprite,this.spritePos.x,this.spritePos.y,t,n,this.xPos,this.yPos,i.config.WIDTH,i.config.HEIGHT),this.canvasCtx.restore()},update:function(e){this.remove||(this.xPos-=Math.ceil(e),this.draw(),this.isVisible()||(this.remove=!0))},isVisible:function(){return this.xPos+i.config.WIDTH>0}};function n(e,n,t){this.spritePos=n,this.canvas=e,this.canvasCtx=e.getContext("2d"),this.xPos=t-50,this.yPos=30,this.currentPhase=0,this.opacity=0,this.containerWidth=t,this.stars=[],this.drawStars=!1,this.placeStars()}n.config={FADE_SPEED:.035,HEIGHT:40,MOON_SPEED:.25,NUM_STARS:2,STAR_SIZE:9,STAR_SPEED:.3,STAR_MAX_Y:70,WIDTH:20},n.phases=[140,120,100,60,40,20,0],n.prototype={update:function(t){if(t&&this.opacity==0&&(this.currentPhase++,this.currentPhase>=n.phases.length&&(this.currentPhase=0)),t&&(this.opacity<1||this.opacity==0)?this.opacity+=n.config.FADE_SPEED:this.opacity>0&&(this.opacity-=n.config.FADE_SPEED),this.opacity>0){if(this.xPos=this.updateXPos(this.xPos,n.config.MOON_SPEED),this.drawStars)for(var e=0;e<n.config.NUM_STARS;e++)this.stars[e].x=this.updateXPos(this.stars[e].x,n.config.STAR_SPEED);this.draw()}else this.opacity=0,this.placeStars();this.drawStars=!0},updateXPos:function(e,t){return e<-n.config.WIDTH?e=this.containerWidth:e-=t,e},draw:function(){var t,o=this.currentPhase==3?n.config.WIDTH*2:n.config.WIDTH,i=n.config.HEIGHT,a=this.spritePos.x+n.phases[this.currentPhase],r=o,s=n.config.STAR_SIZE,c=e.spriteDefinition.LDPI.STAR.x;if(this.canvasCtx.save(),this.canvasCtx.globalAlpha=this.opacity,this.drawStars)for(t=0;t<n.config.NUM_STARS;t++)this.canvasCtx.drawImage(e.imageSprite,c,this.stars[t].sourceY,s,s,Math.round(this.stars[t].x),this.stars[t].y,n.config.STAR_SIZE,n.config.STAR_SIZE);this.canvasCtx.drawImage(e.imageSprite,a,this.spritePos.y,o,i,Math.round(this.xPos),this.yPos,r,n.config.HEIGHT),this.canvasCtx.globalAlpha=1,this.canvasCtx.restore()},placeStars:function(){for(var s=Math.round(this.containerWidth/n.config.NUM_STARS),t=0;t<n.config.NUM_STARS;t++)this.stars[t]={},this.stars[t].x=c(s*t,s*(t+1)),this.stars[t].y=c(0,n.config.STAR_MAX_Y),this.stars[t].sourceY=e.spriteDefinition.LDPI.STAR.y+n.config.STAR_SIZE*t},reset:function(){this.currentPhase=0,this.opacity=0,this.update(!1)}};function a(e,t){this.spritePos=t,this.canvas=e,this.canvasCtx=e.getContext("2d"),this.sourceDimensions={},this.dimensions=a.dimensions,this.sourceXPos=[this.spritePos.x,this.spritePos.x+this.dimensions.WIDTH],this.xPos=[],this.yPos=0,this.bumpThreshold=.5,this.setSourceDimensions(),this.draw()}a.dimensions={WIDTH:600,HEIGHT:12,YPOS:127},a.prototype={setSourceDimensions:function(){for(var e in a.dimensions)this.sourceDimensions[e]=a.dimensions[e],this.dimensions[e]=a.dimensions[e];this.xPos=[0,a.dimensions.WIDTH],this.yPos=a.dimensions.YPOS},getRandomType:function(){return Math.random()>this.bumpThreshold?this.dimensions.WIDTH:0},draw:function(){this.canvasCtx.drawImage(e.imageSprite,this.sourceXPos[0],this.spritePos.y,this.sourceDimensions.WIDTH,this.sourceDimensions.HEIGHT,this.xPos[0],this.yPos,this.dimensions.WIDTH,this.dimensions.HEIGHT),this.canvasCtx.drawImage(e.imageSprite,this.sourceXPos[1],this.spritePos.y,this.sourceDimensions.WIDTH,this.sourceDimensions.HEIGHT,this.xPos[1],this.yPos,this.dimensions.WIDTH,this.dimensions.HEIGHT)},updateXPos:function(t,s){var e=t,n=t==0?1:0;this.xPos[e]-=s,this.xPos[n]=this.xPos[e]+this.dimensions.WIDTH,this.xPos[e]<=-this.dimensions.WIDTH&&(this.xPos[e]+=this.dimensions.WIDTH*2,this.xPos[n]=this.xPos[e]-this.dimensions.WIDTH,this.sourceXPos[e]=this.getRandomType()+this.spritePos.x)},update:function(t,n){var e=Math.floor(n*(h/1e3)*t);this.xPos[0]<=0?this.updateXPos(0,e):this.updateXPos(1,e),this.draw()},reset:function(){this.xPos[0]=0,this.xPos[1]=a.dimensions.WIDTH}};function m(e,t,n,s){this.canvas=e,this.canvasCtx=this.canvas.getContext("2d"),this.config=m.config,this.dimensions=n,this.gapCoefficient=s,this.obstacles=[],this.obstacleHistory=[],this.horizonOffsets=[0,0],this.cloudFrequency=this.config.CLOUD_FREQUENCY,this.spritePos=t,this.nightMode=null,this.clouds=[],this.cloudSpeed=this.config.BG_CLOUD_SPEED,this.horizonLine=null,this.init()}m.config={BG_CLOUD_SPEED:.2,BUMPY_THRESHOLD:.3,CLOUD_FREQUENCY:.5,HORIZON_HEIGHT:16,MAX_CLOUDS:6},m.prototype={init:function(){this.addCloud(),this.horizonLine=new a(this.canvas,this.spritePos.HORIZON),this.nightMode=new n(this.canvas,this.spritePos.MOON,this.dimensions.WIDTH)},update:function(e,t,n,s){this.runningTime+=e,this.horizonLine.update(e,t),this.nightMode.update(s),this.updateClouds(e,t),n&&this.updateObstacles(e,t)},updateClouds:function(s,o){var t,n,i=this.cloudSpeed/1e3*s*o,e=this.clouds.length;if(e){for(t=e-1;t>=0;t--)this.clouds[t].update(i);n=this.clouds[e-1],e<this.config.MAX_CLOUDS&&this.dimensions.WIDTH-n.xPos>n.cloudGap&&this.cloudFrequency>Math.random()&&this.addCloud(),this.clouds=this.clouds.filter(function(e){return!e.remove})}else this.addCloud()},updateObstacles:function(i,t){for(var e,s,o=this.obstacles.slice(0),n=0;n<this.obstacles.length;n++)s=this.obstacles[n],s.update(i,t),s.remove&&o.shift();this.obstacles=o,this.obstacles.length>0?(e=this.obstacles[this.obstacles.length-1],e&&!e.followingObstacleCreated&&e.isVisible()&&e.xPos+e.width+e.gap<this.dimensions.WIDTH&&(this.addNewObstacle(t),e.followingObstacleCreated=!0)):this.addNewObstacle(t)},removeFirstObstacle:function(){this.obstacles.shift()},addNewObstacle:function(n){var s,o=c(0,r.types.length-1),t=r.types[o];this.duplicateObstacleCheck(t.type)||n<t.minSpeed?this.addNewObstacle(n):(s=this.spritePos[t.type],this.obstacles.push(new r(this.canvasCtx,t,s,this.dimensions,this.gapCoefficient,n,t.width)),this.obstacleHistory.unshift(t.type),this.obstacleHistory.length>1&&this.obstacleHistory.splice(e.config.MAX_OBSTACLE_DUPLICATION))},duplicateObstacleCheck:function(s){for(var t=0,n=0;n<this.obstacleHistory.length;n++)t=this.obstacleHistory[n]==s?t+1:0;return t>=e.config.MAX_OBSTACLE_DUPLICATION},reset:function(){this.obstacles=[],this.horizonLine.reset(),this.nightMode.reset()},resize:function(e,t){this.canvas.width=e,this.canvas.height=t},addCloud:function(){this.clouds.push(new i(this.canvas,this.spritePos.CLOUD,this.dimensions.WIDTH))}}})();function onDocumentLoad(){new Runner(".game-wrapper")}document.addEventListener("DOMContentLoaded",onDocumentLoad)