<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><link rel=icon href=/favicon.ico><title>Firewalld快速上手</title><link rel=stylesheet href=/style.min.css></head><body><header class=site-header><div class=logo><svg fill="#909090" t="1651558285715" class="icon" viewBox="0 0 1034 1024" xmlns="http://www.w3.org/2000/svg" p-id="4913" width="200" height="200"><path d="M922.757 679.722c-9.278-52.003-24.544-99.516-43.39-139.068.091-.137.182-.275.275-.408.847.258 1.696.508 2.541.773-.422-.883-.863-1.76-1.292-2.643 12.366-18.578 22.399-39.972 29.136-66.647 3.516-13.909 6.145-29.263 7.783-46.397.818-8.569 1.389-17.584 1.698-27.092.156-4.751.246-9.626.269-14.633.022-5.002-.022-10.14-.133-15.402.081-10.857-.111-21.828-.471-32.944-.359-11.116-.885-22.367-1.475-33.786-1.178-22.837-2.604-46.319-3.434-70.643-1.523-34.468-1.834-70.638-2.67-105.163-19.341 6.757-39.436 15.327-59.56 25.448-81.158 40.989-166.211 107.387-215.76 191.069-1.042 1.655-2.046 3.322-3.049 4.986-38.35-10.217-79.226-15.743-121.656-15.743-43.438.0-85.243 5.795-124.381 16.487-.939-1.447-1.869-2.891-2.834-4.33-53.276-84.088-134.112-149.982-215.583-191.043-20.062-10.118-40.164-18.696-59.515-25.452-.839 34.537-1.153 70.724-2.677 105.213-1.663 48.665-5.701 93.985-5.376 137.427-1.778 83.493 13.639 133.437 39.644 171.555-.142.303-.294.602-.437.905.139-.038.277-.075.416-.112-18.356 39.116-33.223 85.823-42.326 136.86-2.678 15.01-4.747 29.82-6.254 44.359 65.632 10.539 144.907 36.168 225.818 75.514 55.879 27.177 105.924 57.687 147.427 88.735 3.259 3.722 7.779 7.212 12.852 10.232 5.65 3.36 11.912 6.11 17.756 7.969 2.927.931 5.759 1.64 8.428 2.108 1.336.237 2.633.412 3.885.526.625.052 1.241.096 1.846.115.605.021 1.2.027 1.78.018 11.043-.218 22.754-6.308 32.935-14.805h.439c43.386-33.658 97.033-66.961 157.499-96.36 80.923-39.35 160.207-64.979 225.863-75.526-1.484-13.815-3.485-27.877-6.022-42.109zM682.665 760.403c-54.102 27.67-102.101 59.014-140.921 90.693h-.392c-9.11 7.996-19.587 13.728-29.469 13.934-.52.007-1.052.003-1.594-.017-.541-.021-1.09-.059-1.652-.109-1.121-.106-2.282-.27-3.476-.495-2.389-.442-4.923-1.108-7.54-1.985-5.229-1.75-10.831-4.338-15.887-7.5-4.539-2.842-8.584-6.126-11.5-9.63-37.133-29.222-81.911-57.936-131.909-83.515C265.93 724.746 195 700.628 136.278 690.706c1.348-13.683 3.2-27.623 5.597-41.749 7.07-41.692 18.023-80.317 31.533-113.864 11.924-1.751 24.096-2.671 36.471-2.671 143.697.0 261.084 115.913 274.521 266.783h.074c1.127 17.839 12.971 31.877 27.428 31.877 15.201.0 27.523-15.518 27.523-34.659.0-2.258-.177-4.463-.505-6.602 19.173-146.753 126.643-260.464 267.536-260.464 13.608.0 26.973 1.105 40.032 3.213 14.126 34.29 25.577 74.068 32.88 117.121 2.272 13.395 4.061 26.629 5.39 39.631-58.742 9.924-129.68 34.047-202.086 71.082z" p-id="4914"/></svg><a href=/>moefox</a></div><div id=toggle-menu><svg fill="#909090" t="1651821526565" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="1919" width="200" height="200"><path d="M128 725.333333A42.666667 42.666667.0 00170.666667 768h682.666666a42.666667 42.666667.0 100-85.333333H170.666667A42.666667 42.666667.0 00128 725.333333zM128 512a42.666667 42.666667.0 0042.666667 42.666667h682.666666a42.666667 42.666667.0 100-85.333334H170.666667A42.666667 42.666667.0 00128 512zm42.666667-256a42.666667 42.666667.0 000 85.333333h682.666666a42.666667 42.666667.0 100-85.333333H170.666667z" fill="#959ba7" p-id="1920"/></svg></div></header><aside id=sidebar><ol id=main-menu class=menu><li><a href=/archives/><svg fill="#909090" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="20" viewBox="0 0 20 20" enable-background="new 0 0 20 20"><path d="M13 8H7c-.6.0-1-.4-1-1s.4-1 1-1h6c.6.0 1 .4 1 1s-.4 1-1 1z"/><path d="M20 11.7l-3-10C16.8 1.3 16.4 1 16 1H4c-.4.0-.8.3-1 .7l-3 10s0 .2.0.3v6c0 .6.4 1 1 1h18c.6.0 1-.4 1-1v-6C20 11.9 20 11.8 20 11.7zM4.7 3h10.5l2.4 8H13c-.6.0-1 .4-1 1v1H8v-1c0-.6-.4-1-1-1H2.3L4.7 3zM18 17H2v-4h4v1c0 .6.4 1 1 1h6c.6.0 1-.4 1-1v-1h4v4z"/></svg><span>归档</span></a></li></ol></aside><main class="main content-page"><div class=container><article class=content><header><div class=article-title-wrapper><h1 class=article-title>Firewalld快速上手</h1><div class=article-meta><div class=article-time><svg fill="#909090" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="20" viewBox="0 0 20 20" enable-background="new 0 0 20 20"><path d="M19 2h-3V0h-2v2H6V0H4v2H1C.4 2 0 2.4.0 3v16c0 .6.4 1 1 1h18c.6.0 1-.4 1-1V3C20 2.4 19.6 2 19 2zM18 18H2V4h16V18z"/><path d="M7.3 14.7l-2-2c-.4-.4-.4-1 0-1.4s1-.4 1.4.0L8 12.6l5.3-5.3c.4-.4 1-.4 1.4.0s.4 1 0 1.4l-6 6c-.4.4-1 .4-1.4.0z"/></svg><time>2022-05-18</time></div></div></div></header><section class=article><h2 id=为什么要使用防火墙>为什么要使用防火墙</h2><p>不管是个人的电脑还是服务器，防火墙都是很重要的一个部分。<br>尤其是现在 ipv6 逐渐地是使用广泛，个人的电脑或许不能往内网一放，谁都不能直接从公网攻击到。</p><p>就我所在的位置而言，三大运营商的流量都是可以走 ipv6 的，甚至拨号的时候也是默认启用 ipv6 的，这意味着只需要路由器开启就万事具备了。<br>内网现在也不是安全的，个人开发用的 linux 也是很有必要上防火墙的，更别提服务器了。</p><p>linux 上防火墙主要是 iptables 和 firewalld。<br>他们底层的后端，我没用过，但很显然没必要了解，又不是开发防火墙。<br>iptables 我没用过，但越来越多的发行版推荐使用 firewalld，那么用 firewalld 就好了，而且 firewalld 使用起来非常简单。</p><p>再者，开启防火墙并没有什么坏处，为什么不用呢。</p><h2 id=启用启动>启用启动</h2><p>启用(开机启动)的话，一般都会带有 unit 文件了，只需要:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> firewalld
</span></span></code></pre></td></tr></table></div></div><p>启动:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo systemctl start firewalld
</span></span></code></pre></td></tr></table></div></div><p>启动之后，firewalld 就已经在工作了！这意味着，除了 22 号端口的 tcp 链接(sshd 服务的端口，默认启用)以外的所有端口不被允许访问。<br>至此已经足够安全了，毕竟都禁止了。但如果要跑一个 ftp 服务器什么的那么就需要一番配置了。</p><h2 id=firewalld-使用>firewalld 使用</h2><p>firewalld 主要使用的指令就是 firewall-cmd。<br>firewall-cmd 必须以 root 权限运行，下文非必要时则省略了 sudo 或者 root 下运行。</p><h3 id=区域zone>区域(zone)</h3><p>firewalld 将网络划分为不同的区域(zone)，不同的区域对应不同的规则，这是为了快速修改防火墙配置。<br>比如在外面连着公共的网络，这很显然内网是不可信的，应该修改到某个非常严格的配置。<br>而回到家，连着家里的网络，那么这个就相对可信，可以切换到到不那么严格的配置，这个时候只用切换一下 zone 就好了。</p><p>使用 <code>firewall-cmd --lis-all-zones</code> 可以查看所有的区域的所有配置。</p><p>使用 <code>firewall-cmd --info-zone=xxx</code> 或者 <code>firewall-cmd --list-all --zone=xxx</code> 可以查看 xxx 区域下的的防火墙配置。<br>输出大致如下:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo firewall-cmd --info-zone=public
</span></span><span class=line><span class=cl>public (active)
</span></span><span class=line><span class=cl>  target: default
</span></span><span class=line><span class=cl>  icmp-block-inversion: no
</span></span><span class=line><span class=cl>  interfaces: wlp3s0
</span></span><span class=line><span class=cl>  sources:
</span></span><span class=line><span class=cl>  services: dhcpv6-client ssh
</span></span><span class=line><span class=cl>  ports: 22/tcp 8888/tcp 7777/tcp
</span></span><span class=line><span class=cl>  protocols:
</span></span><span class=line><span class=cl>  forward: yes
</span></span><span class=line><span class=cl>  masquerade: no
</span></span><span class=line><span class=cl>  forward-ports:
</span></span><span class=line><span class=cl>  source-ports:
</span></span><span class=line><span class=cl>  icmp-blocks:
</span></span><span class=line><span class=cl>  rich rules:
</span></span></code></pre></td></tr></table></div></div><p>有很多内容，但大多是用不上的。<br><code>public (active)</code> 表示的是目前 public 区域处于激活状态。<br><code>services: dhcpv6-client ssh</code> 这个是默认的，默认启用 ssh 服务。<br><code>interfaces: wlp3s0</code> 表示的是防火墙在 wlp3s0 这个网卡上，多个网卡的话可能需要注意一下。<br><code>ports: 22/tcp 8888/tcp 7777/tcp</code> 则是开放的端口，这里开放了 22，8888，7777 端口的 tcp 连接。<br>其他的默认值都不用在意也不太需要修改，一般情况下用不到。</p><p>使用 <code>firewall-cmd --set-default-zone=xxx</code> 可以设置默认的区域。</p><div class="notice notice-warning"><p>在 <a href=https://wiki.archlinux.org/title/Firewalld_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>arch wiki</a> 上说此指令做出的改变是临时的，但我在 arch 上使用时其实是立即生效并且重启有效，也就是永久有效。<br>我尝试过 &ndash;reload 和重启服务两种重载，都是生效的，所以谨慎使用。</p></div><p>使用 <code>firewall-cmd --get-default-zone</code> 可以获取默认的区域。</p><p>使用 <code>firewall-cmd --zone=xxx --change-interface=xxx</code> 切换激活区域，立即生效，重启失效。</p><h3 id=端口配置>端口配置</h3><p>用 firewalld 来配置端口是否允许进出是非常简单的。</p><p>添加端口:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>firewall-cmd --add-port<span class=o>=</span>a/b <span class=c1># 允许 a 端口 b 协议</span>
</span></span></code></pre></td></tr></table></div></div><p>其中 b 协议大多数时候是 tcp 或者 udp，毕竟很多常用的协议基于这两个。<br>比如http 基于 tcp，所以允许 http，允许 tcp 就好了</p><p>查看端口:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>firewall-cmd --list-ports
</span></span></code></pre></td></tr></table></div></div><p>删除端口:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>firewall-cmd --remove-port<span class=o>=</span>a/b
</span></span></code></pre></td></tr></table></div></div><p>添加和删除都是立即执行的，重启失效，想要永久生效则加上 <code>--permanent</code>。<br>但加上 <code>--permanent</code> 之后是不会立即生效的，需要重新加载一下，使用 <code>firewall-cmd --reload</code>就好了。</p><p>另外，默认这些指令都是作用于默认区域而不是当前激活的区域，可以使用 <code>--zone=xxx</code> 指定作用的区域。</p><h3 id=服务>服务</h3><p>服务就是预配置的一系列端口配置。比如 public 区域默认就启用了 ssh 服务。</p><p>查看所有可用的服务:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>firewall-cmd --services
</span></span></code></pre></td></tr></table></div></div><p>添加服务:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>firewall-cmd --add-service<span class=o>=</span>xxx
</span></span></code></pre></td></tr></table></div></div><p>删除服务:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>firewall-cmd --remove-service<span class=o>=</span>xxx
</span></span></code></pre></td></tr></table></div></div><p>其余的同上述端口部分内容。</p><h3 id=其他>其他</h3><h4 id=应急>应急</h4><p>有时候会有突发情况，不能关机，但想拒绝所有流量，一个一个 remove 是很慢的，可能耽误了。<br>开启应急模式:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>firewall-cmd --panic-on
</span></span></code></pre></td></tr></table></div></div><p>此时会禁止所有流量，就连 ssh 也不例外，慎用。<br>关闭应急模式:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>firewall-cmd --panic-off
</span></span></code></pre></td></tr></table></div></div></section><footer class=footer><div class=copyright><svg fill="#909090" t="1651550399147" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="3700" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style/></defs><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4.0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" p-id="3701"/><path d="M517.6 351.3c53 0 89 33.8 93 83.4.3 4.2 3.8 7.4 8 7.4h56.7c2.6.0 4.7-2.1 4.7-4.7.0-86.7-68.4-147.4-162.7-147.4C407.4 290 344 364.2 344 486.8v52.3C344 660.8 407.4 734 517.3 734c94 0 162.7-58.8 162.7-141.4.0-2.6-2.1-4.7-4.7-4.7h-56.8c-4.2.0-7.6 3.2-8 7.3-4.2 46.1-40.1 77.8-93 77.8-65.3.0-102.1-47.9-102.1-133.6v-52.6c.1-87 37-135.5 102.2-135.5z" p-id="3702"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></div></footer></article></div><aside class=widgets><section class=toc><div class=widget-title-wrapper><svg fill="#909090" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="20" viewBox="0 0 20 20" enable-background="new 0 0 20 20"><path d="M9.7 19.9l-9-3C.3 16.8.0 16.4.0 16V1C0 .3.7-.2 1.3.1L10 2.9 18.7.0C19.3-.2 20 .3 20 1v15c0 .4-.3.8-.7.9l-9 3C10.1 20 9.9 20 9.7 19.9zM2 15.3l8 2.7 8-2.7V2.4L10.3 5C10.1 5 9.9 5 9.7 4.9L2 2.4V15.3z"/><path d="M10 16c-.6.0-1-.4-1-1V8c0-.6.4-1 1-1s1 .4 1 1v7c0 .6-.4 1-1 1z"/></svg><span class=widget-title>目录</span></div><div class=toc-list><nav id=TableOfContents><ul><li><a href=#为什么要使用防火墙>为什么要使用防火墙</a></li><li><a href=#启用启动>启用启动</a></li><li><a href=#firewalld-使用>firewalld 使用</a><ul><li><a href=#区域zone>区域(zone)</a></li><li><a href=#端口配置>端口配置</a></li><li><a href=#服务>服务</a></li><li><a href=#其他>其他</a></li></ul></li></ul></nav></div></section></aside></main><footer class=site-footer><div class=site-copyright><span>© 2022-2022 By nidhoggfgg</span></div></footer><script type=text/javascript src=/js/main.min.js defer></script></body></html>